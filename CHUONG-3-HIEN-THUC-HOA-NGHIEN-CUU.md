# CH∆Ø∆†NG 3: HI·ªÜN TH·ª∞C H√ìA NGHI√äN C·ª®U

## 3.1 Ph√¢n T√≠ch Y√™u C·∫ßu Chi Ti·∫øt

### 3.1.1 Y√™u C·∫ßu Ch·ª©c NƒÉng (Functional Requirements)

#### Y√™u C·∫ßu ƒê·∫∑t Tour

**1. T√¨m Ki·∫øm Tour**

Ng∆∞·ªùi d√πng c·∫ßn c√≥ kh·∫£ nƒÉng t√¨m ki·∫øm tour du l·ªãch theo nhi·ªÅu ti√™u ch√≠ kh√°c nhau ƒë·ªÉ d·ªÖ d√†ng t√¨m ƒë∆∞·ª£c tour ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa m√¨nh. C√°c ti√™u ch√≠ t√¨m ki·∫øm bao g·ªìm:

- **Theo ƒêi·ªÉm ƒê·∫øn**: Ng∆∞·ªùi d√πng c√≥ th·ªÉ nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm ho·∫∑c ch·ªçn t·ª´ danh s√°ch c√°c ƒëi·ªÉm ƒë·∫øn ph·ªï bi·∫øn. H·ªá th·ªëng s·∫Ω t√¨m ki·∫øm t·∫•t c·∫£ tour c√≥ ƒëi·ªÉm ƒë·∫øn tr√πng kh·ªõp.

- **Theo Ng√†y Kh·ªüi H√†nh**: Ng∆∞·ªùi d√πng ch·ªçn kho·∫£ng ng√†y kh·ªüi h√†nh mong mu·ªën. H·ªá th·ªëng s·∫Ω hi·ªÉn th·ªã c√°c tour kh·ªüi h√†nh trong kho·∫£ng th·ªùi gian ƒë√≥.

- **Theo Gi√° Ti·ªÅn**: Ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·ªçn kho·∫£ng gi√° t·ª´ - ƒë·∫øn. H·ªá th·ªëng s·∫Ω l·ªçc c√°c tour c√≥ gi√° n·∫±m trong kho·∫£ng ƒë√≥.

- **Theo Th·ªùi Gian Tour**: Ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·ªçn th·ªùi gian tour (1 ng√†y, 2 ng√†y, 3 ng√†y, v.v.). H·ªá th·ªëng s·∫Ω hi·ªÉn th·ªã c√°c tour c√≥ th·ªùi gian ph√π h·ª£p.

K·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω hi·ªÉn th·ªã d∆∞·ªõi d·∫°ng danh s√°ch c√°c tour card, m·ªói card ch·ª©a:
- H√¨nh ·∫£nh tour
- T√™n tour
- Gi√° ti·ªÅn
- Th·ªùi gian tour
- Rating trung b√¨nh
- N√∫t "Xem Chi Ti·∫øt"

Ng∆∞·ªùi d√πng c√≥ th·ªÉ s·∫Øp x·∫øp k·∫øt qu·∫£ theo:
- Gi√° ti·ªÅn (tƒÉng/gi·∫£m)
- Rating (cao nh·∫•t tr∆∞·ªõc)
- Ng√†y kh·ªüi h√†nh (s·ªõm nh·∫•t tr∆∞·ªõc)
- M·ªõi nh·∫•t

**2. Xem Chi Ti·∫øt Tour**

Khi ng∆∞·ªùi d√πng click v√†o m·ªôt tour, h·ªá th·ªëng s·∫Ω hi·ªÉn th·ªã trang chi ti·∫øt tour v·ªõi th√¥ng tin ƒë·∫ßy ƒë·ªß:

- **Th√¥ng Tin C∆° B·∫£n**: T√™n tour, m√¥ t·∫£ chi ti·∫øt, ƒëi·ªÉm ƒë·∫øn, th·ªùi gian tour, s·ªë ng√†y, s·ªë ƒë√™m.

- **H√¨nh ·∫¢nh v√† Video**: Hi·ªÉn th·ªã album h√¨nh ·∫£nh tour, c√≥ th·ªÉ xem video gi·ªõi thi·ªáu tour.

- **Gi√° Ti·ªÅn**: Hi·ªÉn th·ªã gi√° cho ng∆∞·ªùi l·ªõn, tr·∫ª em, tr·∫ª nh·ªè. C√≥ th·ªÉ hi·ªÉn th·ªã gi√° theo nh√≥m (2-5 ng∆∞·ªùi, 6-10 ng∆∞·ªùi, v.v.).

- **L·ªãch Tr√¨nh Chi Ti·∫øt**: Hi·ªÉn th·ªã l·ªãch tr√¨nh t·ª´ng ng√†y, bao g·ªìm:
  - Th·ªùi gian kh·ªüi h√†nh
  - C√°c ƒë·ªãa ƒëi·ªÉm tham quan
  - Th·ªùi gian tham quan
  - B·ªØa ƒÉn (s√°ng, tr∆∞a, t·ªëi)
  - N∆°i l∆∞u tr√∫

- **D·ªãch V·ª• Bao G·ªìm**: Li·ªát k√™ c√°c d·ªãch v·ª• ƒë∆∞·ª£c bao g·ªìm trong tour:
  - V·∫≠n chuy·ªÉn (xe, t√†u, m√°y bay)
  - L∆∞u tr√∫ (kh√°ch s·∫°n, resort)
  - ƒÇn u·ªëng (b·ªØa s√°ng, tr∆∞a, t·ªëi)
  - H∆∞·ªõng d·∫´n vi√™n
  - B·∫£o hi·ªÉm du l·ªãch
  - V√© v√†o c·ªïng

- **D·ªãch V·ª• Kh√¥ng Bao G·ªìm**: Li·ªát k√™ c√°c d·ªãch v·ª• kh√¥ng ƒë∆∞·ª£c bao g·ªìm.

- **ƒêi·ªÅu Ki·ªán H·ªßy**: Hi·ªÉn th·ªã ch√≠nh s√°ch h·ªßy tour.

- **ƒê√°nh Gi√° v√† B√¨nh Lu·∫≠n**: Hi·ªÉn th·ªã:
  - Rating trung b√¨nh (1-5 sao)
  - S·ªë l∆∞·ª£ng ƒë√°nh gi√°
  - Danh s√°ch b√¨nh lu·∫≠n t·ª´ kh√°ch h√†ng ƒë√£ ƒëi tour
  - N√∫t "Vi·∫øt ƒê√°nh Gi√°" (n·∫øu ƒë√£ ƒëi tour)

- **N√∫t "ƒê·∫∑t Tour Ngay"**: N√∫t CTA (Call To Action) ƒë·ªÉ ng∆∞·ªùi d√πng b·∫Øt ƒë·∫ßu qu√° tr√¨nh ƒë·∫∑t tour.

**3. ƒê·∫∑t Tour**

Khi ng∆∞·ªùi d√πng click "ƒê·∫∑t Tour Ngay", h·ªá th·ªëng s·∫Ω hi·ªÉn th·ªã form ƒë·∫∑t tour v·ªõi c√°c tr∆∞·ªùng th√¥ng tin:

- **Th√¥ng Tin Kh√°ch H√†ng**:
  - H·ªç v√† t√™n (b·∫Øt bu·ªôc): Ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±
  - Email (b·∫Øt bu·ªôc): Ph·∫£i l√† email h·ª£p l·ªá
  - S·ªë ƒëi·ªán tho·∫°i (b·∫Øt bu·ªôc): Ph·∫£i c√≥ 10 ch·ªØ s·ªë
  - ƒê·ªãa ch·ªâ (t√πy ch·ªçn)

- **Th√¥ng Tin Booking**:
  - S·ªë ng∆∞·ªùi l·ªõn (b·∫Øt bu·ªôc): T·ªëi thi·ªÉu 1 ng∆∞·ªùi, t·ªëi ƒëa 50 ng∆∞·ªùi
  - S·ªë tr·∫ª em (t√πy ch·ªçn): T·ª´ 0 ƒë·∫øn 20 tr·∫ª
  - S·ªë tr·∫ª nh·ªè (t√πy ch·ªçn): T·ª´ 0 ƒë·∫øn 10 tr·∫ª
  - Ng√†y kh·ªüi h√†nh (b·∫Øt bu·ªôc): Ph·∫£i >= ng√†y h√¥m nay + 7 ng√†y
  - Y√™u c·∫ßu ƒë·∫∑c bi·ªát (t√πy ch·ªçn): V√≠ d·ª•: gh·∫ø c·∫°nh c·ª≠a s·ªï, y√™u c·∫ßu ƒÉn chay, v.v.

- **Hi·ªÉn Th·ªã T·ªïng Gi√° Ti·ªÅn**: H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t√≠nh to√°n:
  - Gi√° ng∆∞·ªùi l·ªõn √ó s·ªë ng∆∞·ªùi l·ªõn
  - Gi√° tr·∫ª em √ó s·ªë tr·∫ª em
  - Gi√° tr·∫ª nh·ªè √ó s·ªë tr·∫ª nh·ªè
  - C·ªông c√°c kho·∫£n ph√≠ (n·∫øu c√≥)
  - Hi·ªÉn th·ªã t·ªïng ti·ªÅn

- **Validate D·ªØ Li·ªáu**: Tr∆∞·ªõc khi submit, h·ªá th·ªëng s·∫Ω:
  - Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
  - Ki·ªÉm tra ƒë·ªãnh d·∫°ng email, s·ªë ƒëi·ªán tho·∫°i
  - Ki·ªÉm tra ng√†y kh·ªüi h√†nh
  - Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥

- **Submit Form**: Ng∆∞·ªùi d√πng click n√∫t "ƒê·∫∑t Tour Ngay" ƒë·ªÉ submit form.

#### Y√™u C·∫ßu Thanh To√°n

**1. Ch·ªçn Ph∆∞∆°ng Th·ª©c Thanh To√°n**

Sau khi submit form ƒë·∫∑t tour, h·ªá th·ªëng s·∫Ω chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n. Trang n√†y s·∫Ω hi·ªÉn th·ªã:

- **Th√¥ng Tin Booking**: Hi·ªÉn th·ªã l·∫°i th√¥ng tin booking v·ª´a t·∫°o:
  - M√£ booking (VD: TOUR20240115123456789)
  - Ng√†y kh·ªüi h√†nh
  - S·ªë ng∆∞·ªùi
  - T·ªïng ti·ªÅn

- **C√°c Ph∆∞∆°ng Th·ª©c Thanh To√°n**: Hi·ªÉn th·ªã 2 t√πy ch·ªçn:
  - **VNPay**: Thanh to√°n qua th·∫ª ng√¢n h√†ng (Visa, Mastercard, JCB), v√≠ ƒëi·ªán t·ª≠ (Momo, ZaloPay). ∆Øu ƒëi·ªÉm: nhanh, an to√†n, t·ª± ƒë·ªông x√°c nh·∫≠n. Nh∆∞·ª£c ƒëi·ªÉm: ph√≠ giao d·ªãch cao.
  - **Chuy·ªÉn Kho·∫£n**: Thanh to√°n qua chuy·ªÉn kho·∫£n ng√¢n h√†ng. ∆Øu ƒëi·ªÉm: ph√≠ th·∫•p, linh ho·∫°t. Nh∆∞·ª£c ƒëi·ªÉm: c·∫ßn x√°c nh·∫≠n th·ªß c√¥ng.

- **Ch·ªçn Ph∆∞∆°ng Th·ª©c**: Ng∆∞·ªùi d√πng ch·ªçn m·ªôt trong hai ph∆∞∆°ng th·ª©c v√† click "Ti·∫øp T·ª•c".

**2. Thanh To√°n VNPay**

N·∫øu ng∆∞·ªùi d√πng ch·ªçn VNPay:

- **T·∫°o URL Thanh To√°n**: H·ªá th·ªëng s·∫Ω t·∫°o URL thanh to√°n VNPay v·ªõi c√°c th√¥ng tin:
  - M√£ merchant (TMN Code)
  - S·ªë ti·ªÅn
  - M√¥ t·∫£ giao d·ªãch
  - URL callback
  - Timestamp

- **Chuy·ªÉn H∆∞·ªõng**: H·ªá th·ªëng chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng ƒë·∫øn c·ªïng thanh to√°n VNPay.

- **Nh·∫≠p Th√¥ng Tin Th·∫ª**: Ng∆∞·ªùi d√πng nh·∫≠p th√¥ng tin th·∫ª (s·ªë th·∫ª, t√™n ch·ªß th·∫ª, ng√†y h·∫øt h·∫°n, CVV).

- **X√°c Th·ª±c OTP**: VNPay g·ª≠i OTP ƒë·∫øn ƒëi·ªán tho·∫°i ng∆∞·ªùi d√πng, ng∆∞·ªùi d√πng nh·∫≠p OTP ƒë·ªÉ x√°c th·ª±c.

- **X·ª≠ L√Ω Giao D·ªãch**: VNPay x·ª≠ l√Ω giao d·ªãch v√† tr·∫£ k·∫øt qu·∫£.

- **Callback**: VNPay g·ª≠i callback v·ªÅ h·ªá th·ªëng v·ªõi k·∫øt qu·∫£ giao d·ªãch (th√†nh c√¥ng ho·∫∑c th·∫•t b·∫°i).

- **C·∫≠p Nh·∫≠t Tr·∫°ng Th√°i**: H·ªá th·ªëng c·∫≠p nh·∫≠t tr·∫°ng th√°i booking:
  - N·∫øu th√†nh c√¥ng: payment_status = 'paid', booking_status = 'confirmed'
  - N·∫øu th·∫•t b·∫°i: payment_status = 'failed'

- **Hi·ªÉn Th·ªã K·∫øt Qu·∫£**: H·ªá th·ªëng hi·ªÉn th·ªã trang k·∫øt qu·∫£ (th√†nh c√¥ng ho·∫∑c th·∫•t b·∫°i).

**3. Thanh To√°n Chuy·ªÉn Kho·∫£n**

N·∫øu ng∆∞·ªùi d√πng ch·ªçn Chuy·ªÉn Kho·∫£n:

- **Hi·ªÉn Th·ªã Form**: H·ªá th·ªëng hi·ªÉn th·ªã form nh·∫≠p th√¥ng tin chuy·ªÉn kho·∫£n:
  - Ch·ªçn ng√¢n h√†ng (Vietcombank, VietinBank, BIDV, Agribank, Techcombank, v.v.)
  - S·ªë t√†i kho·∫£n (ph·∫£i l√† s·ªë, kh√¥ng c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát)
  - T√™n ch·ªß t√†i kho·∫£n (ph·∫£i l√† ch·ªØ hoa)
  - S·ªë ti·ªÅn (ph·∫£i b·∫±ng t·ªïng ti·ªÅn booking)
  - H·ªç t√™n ng∆∞·ªùi thanh to√°n
  - Email ng∆∞·ªùi thanh to√°n
  - S·ªë ƒëi·ªán tho·∫°i ng∆∞·ªùi thanh to√°n

- **Validate D·ªØ Li·ªáu**: Tr∆∞·ªõc khi submit:
  - Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
  - Ki·ªÉm tra ƒë·ªãnh d·∫°ng s·ªë t√†i kho·∫£n
  - Ki·ªÉm tra s·ªë ti·ªÅn c√≥ b·∫±ng t·ªïng ti·ªÅn booking
  - Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥

- **L∆∞u V√†o Database**: H·ªá th·ªëng l∆∞u th√¥ng tin x√°c nh·∫≠n thanh to√°n v√†o b·∫£ng payment_confirmations:
  - booking_code
  - bank_name
  - account_number
  - account_name
  - amount
  - status = 'pending'
  - created_at

- **Hi·ªÉn Th·ªã Th√¥ng B√°o Th√†nh C√¥ng**: H·ªá th·ªëng hi·ªÉn th·ªã th√¥ng b√°o "X√°c nh·∫≠n th√†nh c√¥ng. Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra v√† x√°c nh·∫≠n trong v√≤ng 30 ph√∫t."

- **G·ª≠i Email**: H·ªá th·ªëng g·ª≠i email x√°c nh·∫≠n ƒë·∫øn kh√°ch h√†ng v·ªõi:
  - M√£ booking
  - Th√¥ng tin chuy·ªÉn kho·∫£n
  - S·ªë ti·ªÅn
  - H∆∞·ªõng d·∫´n ti·∫øp theo

#### Y√™u C·∫ßu Qu·∫£n L√Ω

**1. Qu·∫£n L√Ω Booking**

Admin c√≥ th·ªÉ:
- Xem danh s√°ch t·∫•t c·∫£ booking v·ªõi c√°c th√¥ng tin: m√£ booking, t√™n kh√°ch h√†ng, ng√†y kh·ªüi h√†nh, s·ªë ng∆∞·ªùi, t·ªïng ti·ªÅn, tr·∫°ng th√°i booking, tr·∫°ng th√°i thanh to√°n.
- T√¨m ki·∫øm booking theo m√£ booking, t√™n kh√°ch h√†ng, email, s·ªë ƒëi·ªán tho·∫°i.
- S·∫Øp x·∫øp booking theo ng√†y t·∫°o, ng√†y kh·ªüi h√†nh, t·ªïng ti·ªÅn.
- Xem chi ti·∫øt booking: t·∫•t c·∫£ th√¥ng tin kh√°ch h√†ng, th√¥ng tin tour, y√™u c·∫ßu ƒë·∫∑c bi·ªát.
- S·ª≠a booking: thay ƒë·ªïi s·ªë ng∆∞·ªùi, ng√†y kh·ªüi h√†nh, y√™u c·∫ßu ƒë·∫∑c bi·ªát (n·∫øu ch∆∞a thanh to√°n).
- X√≥a booking: ch·ªâ c√≥ th·ªÉ x√≥a booking ch∆∞a thanh to√°n.
- Export booking: xu·∫•t danh s√°ch booking ra file Excel ho·∫∑c PDF.

**2. Qu·∫£n L√Ω Thanh To√°n**

Admin c√≥ th·ªÉ:
- Xem danh s√°ch t·∫•t c·∫£ thanh to√°n v·ªõi c√°c th√¥ng tin: m√£ booking, ph∆∞∆°ng th·ª©c thanh to√°n, s·ªë ti·ªÅn, tr·∫°ng th√°i thanh to√°n, ng√†y t·∫°o.
- T√¨m ki·∫øm thanh to√°n theo m√£ booking, ph∆∞∆°ng th·ª©c, tr·∫°ng th√°i.
- Xem chi ti·∫øt thanh to√°n: t·∫•t c·∫£ th√¥ng tin chuy·ªÉn kho·∫£n (ng√¢n h√†ng, s·ªë t√†i kho·∫£n, t√™n ch·ªß t√†i kho·∫£n, s·ªë ti·ªÅn).
- X√°c nh·∫≠n thanh to√°n chuy·ªÉn kho·∫£n: ki·ªÉm tra th√¥ng tin chuy·ªÉn kho·∫£n, x√°c nh·∫≠n ho·∫∑c t·ª´ ch·ªëi.
- C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n: t·ª´ 'pending' sang 'confirmed' ho·∫∑c 'rejected'.
- G·ª≠i email x√°c nh·∫≠n: g·ª≠i email cho kh√°ch h√†ng khi x√°c nh·∫≠n thanh to√°n.

**3. Qu·∫£n L√Ω Tour**

Admin c√≥ th·ªÉ:
- Xem danh s√°ch t·∫•t c·∫£ tour v·ªõi c√°c th√¥ng tin: t√™n tour, ƒëi·ªÉm ƒë·∫øn, gi√° ti·ªÅn, th·ªùi gian tour, tr·∫°ng th√°i.
- T·∫°o tour m·ªõi: nh·∫≠p t√™n tour, m√¥ t·∫£, ƒëi·ªÉm ƒë·∫øn, gi√° ti·ªÅn (ng∆∞·ªùi l·ªõn, tr·∫ª em), th·ªùi gian tour, l·ªãch tr√¨nh, d·ªãch v·ª• bao g·ªìm, h√¨nh ·∫£nh.
- S·ª≠a th√¥ng tin tour: thay ƒë·ªïi b·∫•t k·ª≥ th√¥ng tin n√†o c·ªßa tour.
- X√≥a tour: ch·ªâ c√≥ th·ªÉ x√≥a tour ch∆∞a c√≥ booking.
- Qu·∫£n l√Ω l·ªãch tr√¨nh: th√™m, s·ª≠a, x√≥a l·ªãch tr√¨nh c·ªßa tour.
- Qu·∫£n l√Ω h√¨nh ·∫£nh: th√™m, x√≥a h√¨nh ·∫£nh c·ªßa tour.

### 3.1.2 Y√™u C·∫ßu Phi Ch·ª©c NƒÉng (Non-Functional Requirements)

#### Hi·ªáu Su·∫•t (Performance)

**T·ªëc ƒê·ªô T·∫£i Trang**
- Trang ch·ªß ph·∫£i t·∫£i trong < 3 gi√¢y
- Trang danh s√°ch tour ph·∫£i t·∫£i trong < 2 gi√¢y
- Trang chi ti·∫øt tour ph·∫£i t·∫£i trong < 2 gi√¢y
- Trang ƒë·∫∑t tour ph·∫£i t·∫£i trong < 1 gi√¢y

**T·ªëc ƒê·ªô API**
- API response time ph·∫£i < 500ms
- Database query ph·∫£i < 100ms
- H·ªó tr·ª£ 1000 concurrent users

**T·ªëi ∆Øu H√≥a**
- N√©n h√¨nh ·∫£nh ƒë·ªÉ gi·∫£m k√≠ch th∆∞·ªõc
- Minify CSS, JavaScript
- S·ª≠ d·ª•ng caching (browser cache, server cache)
- Lazy loading cho h√¨nh ·∫£nh

#### B·∫£o M·∫≠t (Security)

**M√£ H√≥a D·ªØ Li·ªáu**
- M√£ h√≥a d·ªØ li·ªáu nh·∫°y c·∫£m (s·ªë t√†i kho·∫£n, s·ªë th·∫ª)
- S·ª≠ d·ª•ng HTTPS cho t·∫•t c·∫£ trang
- S·ª≠ d·ª•ng SSL/TLS certificate

**Validate Input**
- Validate t·∫•t c·∫£ input t·ª´ ng∆∞·ªùi d√πng
- Ki·ªÉm tra lo·∫°i d·ªØ li·ªáu, ƒë·ªô d√†i, ƒë·ªãnh d·∫°ng
- Reject input kh√¥ng h·ª£p l·ªá

**Prevent SQL Injection**
- S·ª≠ d·ª•ng Prepared Statements
- Kh√¥ng n·ªëi chu·ªói SQL tr·ª±c ti·∫øp
- Escape d·ªØ li·ªáu ƒë·∫ßu v√†o

**Prevent XSS (Cross-Site Scripting)**
- Encode output khi hi·ªÉn th·ªã
- S·ª≠ d·ª•ng htmlspecialchars() trong PHP
- Validate input tr√™n server

**CSRF Protection**
- S·ª≠ d·ª•ng CSRF token
- Ki·ªÉm tra token tr∆∞·ªõc khi x·ª≠ l√Ω form
- S·ª≠ d·ª•ng SameSite cookie

**Authentication & Authorization**
- Ki·ªÉm tra session ng∆∞·ªùi d√πng
- Ph√¢n quy·ªÅn admin/user
- Ki·ªÉm tra quy·ªÅn tr∆∞·ªõc khi th·ª±c hi·ªán h√†nh ƒë·ªông

#### Kh·∫£ D·ª•ng (Availability)

**Uptime**
- H·ªá th·ªëng ph·∫£i c√≥ uptime 99.9% (t·ªëi ƒëa 8.76 gi·ªù downtime/nƒÉm)
- S·ª≠ d·ª•ng load balancing ƒë·ªÉ ph√¢n t√°n t·∫£i

**Backup**
- Backup database h√†ng ng√†y
- L∆∞u backup ·ªü nhi·ªÅu n∆°i
- C√≥ th·ªÉ restore t·ª´ backup

**Disaster Recovery**
- C√≥ k·∫ø ho·∫°ch ph·ª•c h·ªìi khi x·∫£y ra s·ª± c·ªë
- C√≥ server backup s·∫µn s√†ng
- C√≥ th·ªÉ chuy·ªÉn sang server backup trong < 1 gi·ªù

**Monitoring**
- Gi√°m s√°t uptime c·ªßa h·ªá th·ªëng
- Gi√°m s√°t hi·ªáu su·∫•t (CPU, memory, disk)
- Alert khi c√≥ v·∫•n ƒë·ªÅ

#### Kh·∫£ M·ªü R·ªông (Scalability)

**H·ªó Tr·ª£ TƒÉng D·ªØ Li·ªáu**
- H·ªó tr·ª£ tƒÉng s·ªë l∆∞·ª£ng tour (t·ª´ 100 l√™n 10,000)
- H·ªó tr·ª£ tƒÉng s·ªë l∆∞·ª£ng user (t·ª´ 1,000 l√™n 100,000)
- H·ªó tr·ª£ tƒÉng s·ªë l∆∞·ª£ng booking (t·ª´ 10,000 l√™n 1,000,000)

**Database Optimization**
- S·ª≠ d·ª•ng index cho c√°c c·ªôt t√¨m ki·∫øm
- S·ª≠ d·ª•ng partitioning cho b·∫£ng l·ªõn
- S·ª≠ d·ª•ng caching (Redis, Memcached)

**Horizontal Scaling**
- C√≥ th·ªÉ th√™m server web m·ªõi
- S·ª≠ d·ª•ng load balancer ƒë·ªÉ ph√¢n t√°n t·∫£i
- S·ª≠ d·ª•ng database replication

**Vertical Scaling**
- C√≥ th·ªÉ n√¢ng c·∫•p server (CPU, memory, disk)
- C√≥ th·ªÉ n√¢ng c·∫•p database server

## 3.2 Thi·∫øt K·∫ø Chi Ti·∫øt

### 3.2.1 Thi·∫øt K·∫ø Database

#### B·∫£ng tour_bookings

B·∫£ng n√†y l∆∞u tr·ªØ th√¥ng tin c√°c booking tour c·ªßa kh√°ch h√†ng. C·∫•u tr√∫c b·∫£ng bao g·ªìm:

**C·ªôt Kh√≥a Ch√≠nh**
- `id`: Kh√≥a ch√≠nh, t·ª± ƒë·ªông tƒÉng, d√πng ƒë·ªÉ ƒë·ªãnh danh duy nh·∫•t m·ªói booking trong h·ªá th·ªëng.

**C·ªôt Th√¥ng Tin Booking**
- `booking_code`: M√£ booking duy nh·∫•t, ƒë·ªãnh d·∫°ng TOUR + timestamp + s·ªë ng·∫´u nhi√™n (VD: TOUR20240115123456789). ƒê∆∞·ª£c indexed ƒë·ªÉ t√¨m ki·∫øm nhanh.
- `departure_date`: Ng√†y kh·ªüi h√†nh c·ªßa tour, ƒë·ªãnh d·∫°ng DATE (YYYY-MM-DD).
- `return_date`: Ng√†y tr·ªü v·ªÅ t·ª´ tour, ƒë·ªãnh d·∫°ng DATE (YYYY-MM-DD), t√πy ch·ªçn.
- `destination`: ƒêi·ªÉm ƒë·∫øn du l·ªãch, VARCHAR(255), b·∫Øt bu·ªôc. VD: "H√† N·ªôi", "Sapa", "H·∫° Long", "ƒê√† N·∫µng", v.v.
- `created_at`: Th·ªùi gian t·∫°o booking, t·ª± ƒë·ªông ghi l·∫°i th·ªùi gian hi·ªán t·∫°i.
- `updated_at`: Th·ªùi gian c·∫≠p nh·∫≠t booking l·∫ßn cu·ªëi.

**C·ªôt Th√¥ng Tin Kh√°ch H√†ng**
- `customer_name`: T√™n kh√°ch h√†ng, VARCHAR(100), b·∫Øt bu·ªôc.
- `customer_phone`: S·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng, VARCHAR(20), b·∫Øt bu·ªôc.
- `customer_email`: Email kh√°ch h√†ng, VARCHAR(100), b·∫Øt bu·ªôc, ƒë∆∞·ª£c indexed ƒë·ªÉ t√¨m ki·∫øm nhanh.
- `customer_address`: ƒê·ªãa ch·ªâ kh√°ch h√†ng, VARCHAR(255), t√πy ch·ªçn.

**C·ªôt Th√¥ng Tin S·ªë L∆∞·ª£ng**
- `num_adults`: S·ªë ng∆∞·ªùi l·ªõn, INT, m·∫∑c ƒë·ªãnh 1, b·∫Øt bu·ªôc.
- `num_children`: S·ªë tr·∫ª em, INT, m·∫∑c ƒë·ªãnh 0, t√πy ch·ªçn.
- `num_infants`: S·ªë tr·∫ª nh·ªè (d∆∞·ªõi 2 tu·ªïi), INT, m·∫∑c ƒë·ªãnh 0, t√πy ch·ªçn.

**C·ªôt Th√¥ng Tin Gi√° Ti·ªÅn**
- `total_price`: T·ªïng gi√° ti·ªÅn, DECIMAL(15,2), b·∫Øt bu·ªôc. ƒê∆∞·ª£c t√≠nh t·ª´: (num_adults √ó gi√° ng∆∞·ªùi l·ªõn) + (num_children √ó gi√° tr·∫ª em) + (num_infants √ó gi√° tr·∫ª nh·ªè).

**C·ªôt Th√¥ng Tin Tr·∫°ng Th√°i**
- `booking_status`: Tr·∫°ng th√°i booking, ENUM v·ªõi c√°c gi√° tr·ªã:
  - 'pending': Booking v·ª´a t·∫°o, ch∆∞a thanh to√°n
  - 'confirmed': Booking ƒë√£ thanh to√°n, x√°c nh·∫≠n
  - 'completed': Tour ƒë√£ ho√†n th√†nh
  - 'cancelled': Booking b·ªã h·ªßy
  - M·∫∑c ƒë·ªãnh: 'pending'

- `payment_status`: Tr·∫°ng th√°i thanh to√°n, ENUM v·ªõi c√°c gi√° tr·ªã:
  - 'pending': Ch∆∞a thanh to√°n
  - 'paid': ƒê√£ thanh to√°n
  - 'failed': Thanh to√°n th·∫•t b·∫°i
  - 'refunded': ƒê√£ ho√†n ti·ªÅn
  - M·∫∑c ƒë·ªãnh: 'pending'

**C·ªôt Th√¥ng Tin Kh√°c**
- `special_requests`: Y√™u c·∫ßu ƒë·∫∑c bi·ªát t·ª´ kh√°ch h√†ng, TEXT, t√πy ch·ªçn. VD: "Y√™u c·∫ßu gh·∫ø c·∫°nh c·ª≠a s·ªï", "ƒÇn chay", "Ph√≤ng kh√¥ng h√∫t thu·ªëc", v.v.
- `payment_method`: Ph∆∞∆°ng th·ª©c thanh to√°n, VARCHAR(50). VD: 'vnpay', 'bank_transfer', 'cash'.
- `notes`: Ghi ch√∫ t·ª´ admin, TEXT, t√πy ch·ªçn.

**Index**
- Index tr√™n `booking_code` ƒë·ªÉ t√¨m ki·∫øm nhanh theo m√£ booking.
- Index tr√™n `customer_email` ƒë·ªÉ t√¨m ki·∫øm nhanh theo email.
- Index tr√™n `destination` ƒë·ªÉ t√¨m ki·∫øm nhanh theo ƒëi·ªÉm ƒë·∫øn.
- Index tr√™n `created_at` ƒë·ªÉ s·∫Øp x·∫øp theo ng√†y t·∫°o.
- Index tr√™n `departure_date` ƒë·ªÉ t√¨m ki·∫øm nhanh theo ng√†y kh·ªüi h√†nh.

#### B·∫£ng payment_confirmations

B·∫£ng n√†y l∆∞u tr·ªØ th√¥ng tin x√°c nh·∫≠n thanh to√°n chuy·ªÉn kho·∫£n. C·∫•u tr√∫c b·∫£ng bao g·ªìm:

**C·ªôt Kh√≥a Ch√≠nh**
- `id`: Kh√≥a ch√≠nh, t·ª± ƒë·ªông tƒÉng.

**C·ªôt Li√™n K·∫øt**
- `booking_code`: M√£ booking, VARCHAR(50), b·∫Øt bu·ªôc. ƒê∆∞·ª£c indexed ƒë·ªÉ t√¨m ki·∫øm nhanh. C√≥ r√†ng bu·ªôc kh√≥a ngo·∫°i tham chi·∫øu ƒë·∫øn b·∫£ng tour_bookings.

**C·ªôt Th√¥ng Tin Chuy·ªÉn Kho·∫£n**
- `bank_name`: T√™n ng√¢n h√†ng, VARCHAR(100). VD: 'Vietcombank', 'VietinBank', 'BIDV'.
- `account_number`: S·ªë t√†i kho·∫£n, VARCHAR(50). Ch·ªâ ch·ª©a s·ªë, kh√¥ng c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát.
- `account_name`: T√™n ch·ªß t√†i kho·∫£n, VARCHAR(100). Ph·∫£i l√† ch·ªØ hoa.
- `amount`: S·ªë ti·ªÅn chuy·ªÉn kho·∫£n, DECIMAL(15,2).

**C·ªôt Tr·∫°ng Th√°i**
- `status`: Tr·∫°ng th√°i x√°c nh·∫≠n, ENUM v·ªõi c√°c gi√° tr·ªã:
  - 'pending': Ch·ªù x√°c nh·∫≠n t·ª´ admin
  - 'confirmed': Admin ƒë√£ x√°c nh·∫≠n thanh to√°n
  - 'rejected': Admin t·ª´ ch·ªëi thanh to√°n
  - M·∫∑c ƒë·ªãnh: 'pending'
  - ƒê∆∞·ª£c indexed ƒë·ªÉ t√¨m ki·∫øm nhanh.

**C·ªôt Th·ªùi Gian**
- `created_at`: Th·ªùi gian t·∫°o x√°c nh·∫≠n, t·ª± ƒë·ªông ghi l·∫°i.
- `updated_at`: Th·ªùi gian c·∫≠p nh·∫≠t l·∫ßn cu·ªëi.

### 3.2.2 Thi·∫øt K·∫ø API

#### API Endpoint: POST /api/bookings.php

**M·ª•c ƒê√≠ch**: T·∫°o booking tour m·ªõi

**Tham S·ªë ƒê·∫ßu V√†o**:
- `action`: H√†nh ƒë·ªông c·∫ßn th·ª±c hi·ªán ('create', 'update', 'delete', 'get')
- `customer_name`: T√™n kh√°ch h√†ng (b·∫Øt bu·ªôc)
- `customer_email`: Email kh√°ch h√†ng (b·∫Øt bu·ªôc)
- `customer_phone`: S·ªë ƒëi·ªán tho·∫°i (b·∫Øt bu·ªôc)
- `num_adults`: S·ªë ng∆∞·ªùi l·ªõn (b·∫Øt bu·ªôc)
- `num_children`: S·ªë tr·∫ª em (t√πy ch·ªçn)
- `departure_date`: Ng√†y kh·ªüi h√†nh (b·∫Øt bu·ªôc)
- `special_requests`: Y√™u c·∫ßu ƒë·∫∑c bi·ªát (t√πy ch·ªçn)

**K·∫øt Qu·∫£ Tr·∫£ V·ªÅ (Th√†nh C√¥ng)**:
- `success`: true
- `message`: "Booking created successfully"
- `booking_code`: M√£ booking v·ª´a t·∫°o
- `total_price`: T·ªïng gi√° ti·ªÅn

**K·∫øt Qu·∫£ Tr·∫£ V·ªÅ (L·ªói)**:
- `success`: false
- `message`: M√¥ t·∫£ l·ªói
- `error_code`: M√£ l·ªói (VALIDATION_ERROR, DATABASE_ERROR, v.v.)

**Quy Tr√¨nh X·ª≠ L√Ω**:
1. Nh·∫≠n tham s·ªë t·ª´ request
2. Validate d·ªØ li·ªáu (ki·ªÉm tra tr∆∞·ªùng b·∫Øt bu·ªôc, ƒë·ªãnh d·∫°ng, v.v.)
3. T√≠nh t·ªïng gi√° ti·ªÅn
4. T·∫°o m√£ booking
5. Insert v√†o database
6. Tr·∫£ v·ªÅ k·∫øt qu·∫£

#### API Endpoint: POST /api/process-payment.php

**M·ª•c ƒê√≠ch**: X·ª≠ l√Ω thanh to√°n chuy·ªÉn kho·∫£n

**Tham S·ªë ƒê·∫ßu V√†o**:
- `action`: 'confirm_transfer'
- `booking_code`: M√£ booking
- `bank_name`: T√™n ng√¢n h√†ng
- `account_number`: S·ªë t√†i kho·∫£n
- `account_name`: T√™n ch·ªß t√†i kho·∫£n
- `amount`: S·ªë ti·ªÅn
- `payer_name`: T√™n ng∆∞·ªùi thanh to√°n
- `payer_email`: Email ng∆∞·ªùi thanh to√°n
- `payer_phone`: S·ªë ƒëi·ªán tho·∫°i ng∆∞·ªùi thanh to√°n

**K·∫øt Qu·∫£ Tr·∫£ V·ªÅ (Th√†nh C√¥ng)**:
- `success`: true
- `message`: "Payment confirmation saved"
- `confirmation_id`: ID x√°c nh·∫≠n v·ª´a t·∫°o

**K·∫øt Qu·∫£ Tr·∫£ V·ªÅ (L·ªói)**:
- `success`: false
- `message`: M√¥ t·∫£ l·ªói

**Quy Tr√¨nh X·ª≠ L√Ω**:
1. Nh·∫≠n tham s·ªë t·ª´ request
2. Validate d·ªØ li·ªáu
3. Ki·ªÉm tra booking c√≥ t·ªìn t·∫°i kh√¥ng
4. Ki·ªÉm tra s·ªë ti·ªÅn c√≥ b·∫±ng t·ªïng ti·ªÅn booking kh√¥ng
5. Insert v√†o b·∫£ng payment_confirmations
6. G·ª≠i email x√°c nh·∫≠n cho kh√°ch h√†ng
7. Tr·∫£ v·ªÅ k·∫øt qu·∫£

#### API Endpoint: GET /api/tours.php

**M·ª•c ƒê√≠ch**: L·∫•y danh s√°ch tour ho·∫∑c chi ti·∫øt tour

**Tham S·ªë ƒê·∫ßu V√†o**:
- `action`: 'list' ho·∫∑c 'get'
- `id`: ID tour (n·∫øu action = 'get')
- `search`: T·ª´ kh√≥a t√¨m ki·∫øm (n·∫øu action = 'list')
- `sort`: C√°ch s·∫Øp x·∫øp (price_asc, price_desc, rating, date)
- `limit`: S·ªë l∆∞·ª£ng k·∫øt qu·∫£ (m·∫∑c ƒë·ªãnh 10)
- `offset`: V·ªã tr√≠ b·∫Øt ƒë·∫ßu (m·∫∑c ƒë·ªãnh 0)

**K·∫øt Qu·∫£ Tr·∫£ V·ªÅ**:
- Danh s√°ch tour ho·∫∑c chi ti·∫øt tour v·ªõi c√°c th√¥ng tin: ID, t√™n, m√¥ t·∫£, gi√° ti·ªÅn, th·ªùi gian, rating, v.v.

### 3.2.3 Thi·∫øt K·∫ø Giao Di·ªán

#### Trang ƒê·∫∑t Tour (dat-tour.php)

**B·ªë C·ª•c Trang**:
- **Header**: Ch·ª©a logo, menu navigation, n√∫t ƒëƒÉng nh·∫≠p/ƒëƒÉng k√Ω
- **Ti√™u ƒê·ªÅ**: "ƒê·∫∑t Tour Du L·ªãch" v·ªõi m√¥ t·∫£ ng·∫Øn
- **Form ƒê·∫∑t Tour**: Ch·ª©a c√°c tr∆∞·ªùng nh·∫≠p li·ªáu
- **Footer**: Ch·ª©a th√¥ng tin li√™n h·ªá, link, copyright

**C√°c Ph·∫ßn C·ªßa Form**:
1. **Ph·∫ßn Th√¥ng Tin Kh√°ch H√†ng**:
   - H·ªç v√† t√™n (text input, b·∫Øt bu·ªôc)
   - Email (email input, b·∫Øt bu·ªôc)
   - S·ªë ƒëi·ªán tho·∫°i (tel input, b·∫Øt bu·ªôc)
   - ƒê·ªãa ch·ªâ (text input, t√πy ch·ªçn)

2. **Ph·∫ßn Th√¥ng Tin Booking**:
   - S·ªë ng∆∞·ªùi l·ªõn (number input, b·∫Øt bu·ªôc, min=1, max=50)
   - S·ªë tr·∫ª em (number input, t√πy ch·ªçn, min=0, max=20)
   - Ng√†y kh·ªüi h√†nh (date input, b·∫Øt bu·ªôc)
   - Y√™u c·∫ßu ƒë·∫∑c bi·ªát (textarea, t√πy ch·ªçn)

3. **Ph·∫ßn Hi·ªÉn Th·ªã Gi√°**:
   - Gi√° ng∆∞·ªùi l·ªõn √ó s·ªë ng∆∞·ªùi l·ªõn
   - Gi√° tr·∫ª em √ó s·ªë tr·∫ª em
   - T·ªïng ti·ªÅn (in ƒë·∫≠m, m√†u n·ªïi b·∫≠t)

4. **N√∫t Submit**:
   - N√∫t "ƒê·∫∑t Tour Ngay" (m√†u xanh, k√≠ch th∆∞·ªõc l·ªõn)
   - N√∫t "Quay L·∫°i" (m√†u x√°m)

**Responsive Design**:
- Tr√™n desktop: Form hi·ªÉn th·ªã 2 c·ªôt
- Tr√™n tablet: Form hi·ªÉn th·ªã 1 c·ªôt
- Tr√™n mobile: Form hi·ªÉn th·ªã 1 c·ªôt, k√≠ch th∆∞·ªõc nh·ªè h∆°n

#### Trang Ch·ªçn Ph∆∞∆°ng Th·ª©c Thanh To√°n (payment-tour-method.php)

**B·ªë C·ª•c Trang**:
- **Header**: Ch·ª©a logo, menu navigation
- **Ti√™u ƒê·ªÅ**: "Ch·ªçn Ph∆∞∆°ng Th·ª©c Thanh To√°n"
- **Th√¥ng Tin Booking**: Hi·ªÉn th·ªã l·∫°i th√¥ng tin booking v·ª´a t·∫°o
- **C√°c Ph∆∞∆°ng Th·ª©c Thanh To√°n**: Hi·ªÉn th·ªã 2 t√πy ch·ªçn (VNPay, Chuy·ªÉn Kho·∫£n)
- **N√∫t H√†nh ƒê·ªông**: N√∫t "Ti·∫øp T·ª•c", "Quay L·∫°i"
- **Footer**: Ch·ª©a th√¥ng tin li√™n h·ªá

**Th√¥ng Tin Booking**:
- M√£ booking (VD: TOUR20240115123456789)
- Ng√†y kh·ªüi h√†nh (ƒë·ªãnh d·∫°ng: dd/mm/yyyy)
- S·ªë ng∆∞·ªùi (VD: 3 ng∆∞·ªùi)
- T·ªïng ti·ªÅn (ƒë·ªãnh d·∫°ng: 1.300.000 VNƒê)

**C√°c Ph∆∞∆°ng Th·ª©c Thanh To√°n**:
M·ªói ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c hi·ªÉn th·ªã d∆∞·ªõi d·∫°ng card v·ªõi:
- Icon (üí≥ cho VNPay, üè¶ cho Chuy·ªÉn Kho·∫£n)
- T√™n ph∆∞∆°ng th·ª©c
- M√¥ t·∫£ ng·∫Øn
- Radio button ƒë·ªÉ ch·ªçn

**Responsive Design**:
- Tr√™n desktop: 2 card hi·ªÉn th·ªã c·∫°nh nhau
- Tr√™n tablet: 2 card hi·ªÉn th·ªã c·∫°nh nhau
- Tr√™n mobile: 2 card hi·ªÉn th·ªã x·∫øp ch·ªìng

#### Trang Form Thanh To√°n (payment-tour-form.php)

**B·ªë C·ª•c Trang**:
- **Header**: Ch·ª©a logo, menu navigation
- **Ti√™u ƒê·ªÅ**: "Thanh To√°n Tour"
- **Hi·ªÉn Th·ªã T·ªïng Ti·ªÅn**: Hi·ªÉn th·ªã t·ªïng ti·ªÅn c·∫ßn thanh to√°n (in ƒë·∫≠m, m√†u n·ªïi b·∫≠t)
- **Form Thanh To√°n**: Ch·ª©a c√°c tr∆∞·ªùng nh·∫≠p li·ªáu
- **N√∫t H√†nh ƒê·ªông**: N√∫t "X√°c Nh·∫≠n ƒê√£ Chuy·ªÉn Kho·∫£n", "Quay L·∫°i"
- **Footer**: Ch·ª©a th√¥ng tin li√™n h·ªá

**C√°c Ph·∫ßn C·ªßa Form**:
1. **Ph·∫ßn Th√¥ng Tin T√†i Kho·∫£n Chuy·ªÉn Kho·∫£n**:
   - Ch·ªçn ng√¢n h√†ng (select dropdown, b·∫Øt bu·ªôc)
   - S·ªë t√†i kho·∫£n (text input, b·∫Øt bu·ªôc)
   - T√™n ch·ªß t√†i kho·∫£n (text input, b·∫Øt bu·ªôc)
   - S·ªë ti·ªÅn c·∫ßn chuy·ªÉn (number input, b·∫Øt bu·ªôc, m·∫∑c ƒë·ªãnh = t·ªïng ti·ªÅn)

2. **Ph·∫ßn Th√¥ng Tin Ng∆∞·ªùi Thanh To√°n**:
   - H·ªç t√™n (text input, b·∫Øt bu·ªôc)
   - Email (email input, b·∫Øt bu·ªôc)
   - S·ªë ƒëi·ªán tho·∫°i (tel input, b·∫Øt bu·ªôc)

3. **Ph·∫ßn L∆∞u √ù**:
   - Hi·ªÉn th·ªã l∆∞u √Ω: "Vui l√≤ng nh·∫≠p ƒë√∫ng th√¥ng tin t√†i kho·∫£n b·∫°n ƒë√£ chuy·ªÉn kho·∫£n"

**Responsive Design**:
- Tr√™n desktop: Form hi·ªÉn th·ªã 1 c·ªôt
- Tr√™n tablet: Form hi·ªÉn th·ªã 1 c·ªôt
- Tr√™n mobile: Form hi·ªÉn th·ªã 1 c·ªôt, k√≠ch th∆∞·ªõc nh·ªè h∆°n

## 3.3 C√†i ƒê·∫∑t M√¥i Tr∆∞·ªùng

### 3.3.1 Y√™u C·∫ßu H·ªá Th·ªëng

**Ph·∫ßn C·ª©ng**:
- CPU: T·ªëi thi·ªÉu 2 cores, khuy√™n d√πng 4 cores
- RAM: T·ªëi thi·ªÉu 2GB, khuy√™n d√πng 4GB
- Disk: T·ªëi thi·ªÉu 10GB, khuy√™n d√πng 50GB
- Bandwidth: T·ªëi thi·ªÉu 10Mbps

**Ph·∫ßn M·ªÅm**:
- **PHP**: Phi√™n b·∫£n 7.4 tr·ªü l√™n (khuy√™n d√πng 8.0+)
  - Extensions c·∫ßn thi·∫øt: PDO, MySQLi, cURL, JSON, OpenSSL
  - Memory limit: T·ªëi thi·ªÉu 128MB, khuy√™n d√πng 256MB
  - Max upload size: T·ªëi thi·ªÉu 10MB, khuy√™n d√πng 50MB

- **MySQL**: Phi√™n b·∫£n 5.7 tr·ªü l√™n (khuy√™n d√πng 8.0+)
  - Character set: utf8mb4
  - Collation: utf8mb4_unicode_ci
  - Max connections: T·ªëi thi·ªÉu 100, khuy√™n d√πng 500

- **Web Server**: Apache 2.4+ ho·∫∑c Nginx 1.18+
  - H·ªó tr·ª£ .htaccess (n·∫øu d√πng Apache)
  - H·ªó tr·ª£ rewrite module
  - SSL/TLS support

- **C√¥ng C·ª• Kh√°c**:
  - Composer (optional, ƒë·ªÉ qu·∫£n l√Ω dependencies)
  - Git (optional, ƒë·ªÉ version control)
  - cURL (ƒë·ªÉ g·ªçi API VNPay)

### 3.3.2 C√†i ƒê·∫∑t Database

**B∆∞·ªõc 1: T·∫°o Database**
- K·∫øt n·ªëi ƒë·∫øn MySQL server
- T·∫°o database m·ªõi v·ªõi t√™n 'travinh_tourism'
- Ch·ªâ ƒë·ªãnh character set l√† utf8mb4 v√† collation l√† utf8mb4_unicode_ci
- ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o h·ªó tr·ª£ ti·∫øng Vi·ªát v√† c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát

**B∆∞·ªõc 2: T·∫°o B·∫£ng**
- Ch·∫°y file SQL `database/create-tour-bookings.sql` ƒë·ªÉ t·∫°o b·∫£ng tour_bookings
- Ch·∫°y file SQL `database/create-payment-confirmations.sql` ƒë·ªÉ t·∫°o b·∫£ng payment_confirmations
- Ch·∫°y file SQL `database/create-tours-table.sql` ƒë·ªÉ t·∫°o b·∫£ng tours
- Ch·∫°y file SQL `database/create_users_simple.sql` ƒë·ªÉ t·∫°o b·∫£ng users

**B∆∞·ªõc 3: Insert D·ªØ Li·ªáu M·∫´u**
- Ch·∫°y file SQL `database/insert-tours-data.sql` ƒë·ªÉ insert d·ªØ li·ªáu tour m·∫´u
- Ch·∫°y file SQL `database/du-lieu-dat-tour-mau.sql` ƒë·ªÉ insert d·ªØ li·ªáu booking m·∫´u
- D·ªØ li·ªáu m·∫´u gi√∫p test h·ªá th·ªëng

**B∆∞·ªõc 4: T·∫°o Index**
- T·∫°o index tr√™n c√°c c·ªôt t√¨m ki·∫øm (booking_code, customer_email, created_at)
- Index gi√∫p tƒÉng t·ªëc ƒë·ªô t√¨m ki·∫øm

### 3.3.3 C·∫•u H√¨nh ·ª®ng D·ª•ng

**C·∫•u H√¨nh Database**:
- File: `config/database.php`
- C·∫ßn c·∫≠p nh·∫≠t:
  - DB_HOST: ƒê·ªãa ch·ªâ server MySQL (th∆∞·ªùng l√† 'localhost')
  - DB_USER: T√™n user MySQL (th∆∞·ªùng l√† 'root')
  - DB_PASS: M·∫≠t kh·∫©u MySQL
  - DB_NAME: T√™n database ('travinh_tourism')
  - DB_PORT: Port MySQL (m·∫∑c ƒë·ªãnh 3306)

**C·∫•u H√¨nh VNPay**:
- File: `config/vnpay.php`
- C·∫ßn c·∫≠p nh·∫≠t:
  - VNP_TMNCODE: M√£ merchant t·ª´ VNPay
  - VNP_HASHSECRET: Secret key t·ª´ VNPay
  - VNP_URL: URL c·ªïng thanh to√°n VNPay
  - VNP_RETURN_URL: URL callback khi thanh to√°n xong
  - VNP_NOTIFY_URL: URL webhook t·ª´ VNPay

**C·∫•u H√¨nh Email**:
- File: `config/email.php` (n·∫øu c√≥)
- C·∫ßn c·∫≠p nh·∫≠t:
  - SMTP_HOST: ƒê·ªãa ch·ªâ SMTP server
  - SMTP_PORT: Port SMTP (th∆∞·ªùng 587 ho·∫∑c 465)
  - SMTP_USER: Email g·ª≠i
  - SMTP_PASS: M·∫≠t kh·∫©u email
  - FROM_EMAIL: Email g·ª≠i t·ª´
  - FROM_NAME: T√™n g·ª≠i t·ª´

**C·∫•u H√¨nh OAuth (n·∫øu c√≥)**:
- File: `config/oauth.php`
- C·∫ßn c·∫≠p nh·∫≠t:
  - GOOGLE_CLIENT_ID: Client ID t·ª´ Google
  - GOOGLE_CLIENT_SECRET: Client Secret t·ª´ Google
  - GOOGLE_REDIRECT_URI: URL redirect sau khi ƒëƒÉng nh·∫≠p Google

**C·∫•u H√¨nh ·ª®ng D·ª•ng Chung**:
- File: `config/app.php` (n·∫øu c√≥)
- C·∫ßn c·∫≠p nh·∫≠t:
  - APP_NAME: T√™n ·ª©ng d·ª•ng
  - APP_URL: URL ·ª©ng d·ª•ng
  - APP_ENV: M√¥i tr∆∞·ªùng (development, production)
  - APP_DEBUG: B·∫≠t/t·∫Øt debug mode
  - TIMEZONE: M√∫i gi·ªù (Asia/Ho_Chi_Minh)
  - CURRENCY: ƒê∆°n v·ªã ti·ªÅn t·ªá (VND)

## 3.4 Tri·ªÉn Khai Ch·ª©c NƒÉng

### 3.4.1 Ch·ª©c NƒÉng ƒê·∫∑t Tour

#### File: dat-tour.php

**M·ª•c ƒê√≠ch**: Hi·ªÉn th·ªã form ƒë·∫∑t tour cho ng∆∞·ªùi d√πng

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **Hi·ªÉn Th·ªã Form**: Trang n√†y hi·ªÉn th·ªã form ƒë·∫∑t tour v·ªõi c√°c tr∆∞·ªùng nh·∫≠p li·ªáu. Form ƒë∆∞·ª£c thi·∫øt k·∫ø responsive, ph√π h·ª£p v·ªõi desktop, tablet, mobile.

2. **Validate Client-Side**: S·ª≠ d·ª•ng JavaScript ƒë·ªÉ validate d·ªØ li·ªáu tr∆∞·ªõc khi submit:
   - Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng
   - Ki·ªÉm tra ƒë·ªãnh d·∫°ng email (ph·∫£i ch·ª©a @)
   - Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i (ph·∫£i c√≥ 10 ch·ªØ s·ªë)
   - Ki·ªÉm tra h·ªç t√™n (ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±)
   - Ki·ªÉm tra ng√†y kh·ªüi h√†nh (ph·∫£i >= ng√†y h√¥m nay + 7 ng√†y)
   - Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥

3. **T√≠nh To√°n Gi√° Ti·ªÅn**: Khi ng∆∞·ªùi d√πng thay ƒë·ªïi s·ªë ng∆∞·ªùi, form s·∫Ω t·ª± ƒë·ªông t√≠nh to√°n l·∫°i t·ªïng gi√° ti·ªÅn:
   - Gi√° ng∆∞·ªùi l·ªõn √ó s·ªë ng∆∞·ªùi l·ªõn
   - Gi√° tr·∫ª em √ó s·ªë tr·∫ª em
   - C·ªông l·∫°i ƒë·ªÉ ƒë∆∞·ª£c t·ªïng ti·ªÅn
   - Hi·ªÉn th·ªã t·ªïng ti·ªÅn d∆∞·ªõi d·∫°ng ti·ªÅn t·ªá (VD: 1.300.000 VNƒê)

4. **Submit Form**: Khi ng∆∞·ªùi d√πng click n√∫t "ƒê·∫∑t Tour Ngay", form s·∫Ω submit ƒë·∫øn file `process-booking.php` b·∫±ng ph∆∞∆°ng th·ª©c POST.

#### File: process-booking.php

**M·ª•c ƒê√≠ch**: X·ª≠ l√Ω form ƒë·∫∑t tour t·ª´ ph√≠a server

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **Ki·ªÉm Tra Request**: Ki·ªÉm tra xem request c√≥ ph·∫£i l√† POST kh√¥ng. N·∫øu kh√¥ng, hi·ªÉn th·ªã l·ªói.

2. **L·∫•y D·ªØ Li·ªáu**: L·∫•y d·ªØ li·ªáu t·ª´ form:
   - customer_name, customer_email, customer_phone
   - num_adults, num_children
   - departure_date, special_requests

3. **Validate Server-Side**: Validate d·ªØ li·ªáu tr√™n server (quan tr·ªçng v√¨ client-side c√≥ th·ªÉ b·ªã bypass):
   - Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
   - Ki·ªÉm tra ƒë·ªãnh d·∫°ng email (s·ª≠ d·ª•ng filter_var)
   - Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i (s·ª≠ d·ª•ng regex)
   - Ki·ªÉm tra h·ªç t√™n (ƒë·ªô d√†i >= 3)
   - Ki·ªÉm tra ng√†y kh·ªüi h√†nh (>= ng√†y h√¥m nay + 7 ng√†y)
   - N·∫øu c√≥ l·ªói, hi·ªÉn th·ªã trang l·ªói

4. **K·∫øt N·ªëi Database**: K·∫øt n·ªëi ƒë·∫øn database b·∫±ng class Database.

5. **T·∫°o M√£ Booking**: T·∫°o m√£ booking duy nh·∫•t:
   - ƒê·ªãnh d·∫°ng: TOUR + timestamp (YYYYMMDDHHmmss) + s·ªë ng·∫´u nhi√™n (100-999)
   - VD: TOUR20240115123456789

6. **T√≠nh T·ªïng Gi√° Ti·ªÅn**:
   - Gi√° ng∆∞·ªùi l·ªõn = 500.000 VNƒê
   - Gi√° tr·∫ª em = 300.000 VNƒê
   - T·ªïng ti·ªÅn = (num_adults √ó 500000) + (num_children √ó 300000)

7. **Insert V√†o Database**: Insert booking v√†o b·∫£ng tour_bookings:
   - booking_code, departure_date, customer_name, customer_phone, customer_email
   - num_adults, num_children, total_price
   - booking_status = 'pending', payment_status = 'pending'
   - S·ª≠ d·ª•ng Prepared Statements ƒë·ªÉ tr√°nh SQL injection

8. **X·ª≠ L√Ω L·ªói**: N·∫øu insert th·∫•t b·∫°i, hi·ªÉn th·ªã trang l·ªói v·ªõi th√¥ng b√°o chi ti·∫øt.

9. **Chuy·ªÉn H∆∞·ªõng**: N·∫øu insert th√†nh c√¥ng, chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang `payment-tour-method.php?booking_id=TOUR...`

### 3.4.2 Ch·ª©c NƒÉng Thanh To√°n

#### File: payment-tour-method.php

**M·ª•c ƒê√≠ch**: Cho ph√©p ng∆∞·ªùi d√πng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **L·∫•y Booking ID**: L·∫•y booking_id t·ª´ URL parameter.

2. **Ki·ªÉm Tra Booking**: Ki·ªÉm tra xem booking c√≥ t·ªìn t·∫°i trong database kh√¥ng. N·∫øu kh√¥ng, hi·ªÉn th·ªã l·ªói.

3. **L·∫•y Th√¥ng Tin Booking**: Query database ƒë·ªÉ l·∫•y th√¥ng tin booking:
   - booking_code, departure_date, num_adults, num_children, total_price

4. **Hi·ªÉn Th·ªã Th√¥ng Tin**: Hi·ªÉn th·ªã l·∫°i th√¥ng tin booking cho ng∆∞·ªùi d√πng x√°c nh·∫≠n:
   - M√£ booking
   - Ng√†y kh·ªüi h√†nh
   - S·ªë ng∆∞·ªùi
   - T·ªïng ti·ªÅn

5. **Hi·ªÉn Th·ªã Ph∆∞∆°ng Th·ª©c Thanh To√°n**: Hi·ªÉn th·ªã 2 t√πy ch·ªçn:
   - VNPay (thanh to√°n qua th·∫ª)
   - Chuy·ªÉn Kho·∫£n (thanh to√°n qua ng√¢n h√†ng)
   - M·ªói t√πy ch·ªçn ƒë∆∞·ª£c hi·ªÉn th·ªã d∆∞·ªõi d·∫°ng card v·ªõi icon, t√™n, m√¥ t·∫£

6. **Ch·ªçn Ph∆∞∆°ng Th·ª©c**: Ng∆∞·ªùi d√πng ch·ªçn m·ªôt ph∆∞∆°ng th·ª©c b·∫±ng radio button.

7. **Submit Form**: Khi ng∆∞·ªùi d√πng click "Ti·∫øp T·ª•c", form submit ƒë·∫øn:
   - N·∫øu ch·ªçn VNPay: chuy·ªÉn h∆∞·ªõng ƒë·∫øn `payment-vnpay.php`
   - N·∫øu ch·ªçn Chuy·ªÉn Kho·∫£n: chuy·ªÉn h∆∞·ªõng ƒë·∫øn `payment-tour-form.php`

#### File: payment-tour-form.php

**M·ª•c ƒê√≠ch**: X·ª≠ l√Ω thanh to√°n chuy·ªÉn kho·∫£n

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **L·∫•y Booking ID**: L·∫•y booking_id t·ª´ POST parameter.

2. **L·∫•y Th√¥ng Tin Booking**: Query database ƒë·ªÉ l·∫•y th√¥ng tin booking.

3. **Hi·ªÉn Th·ªã Form**: Hi·ªÉn th·ªã form nh·∫≠p th√¥ng tin chuy·ªÉn kho·∫£n:
   - Ch·ªçn ng√¢n h√†ng (select dropdown)
   - S·ªë t√†i kho·∫£n (text input)
   - T√™n ch·ªß t√†i kho·∫£n (text input)
   - S·ªë ti·ªÅn (number input, m·∫∑c ƒë·ªãnh = t·ªïng ti·ªÅn)
   - H·ªç t√™n ng∆∞·ªùi thanh to√°n (text input)
   - Email (email input)
   - S·ªë ƒëi·ªán tho·∫°i (tel input)

4. **Validate Client-Side**: S·ª≠ d·ª•ng JavaScript ƒë·ªÉ validate:
   - Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
   - Ki·ªÉm tra ƒë·ªãnh d·∫°ng s·ªë t√†i kho·∫£n (ch·ªâ s·ªë)
   - Ki·ªÉm tra s·ªë ti·ªÅn (ph·∫£i b·∫±ng t·ªïng ti·ªÅn booking)
   - Hi·ªÉn th·ªã th√¥ng b√°o l·ªói

5. **Submit AJAX**: Khi ng∆∞·ªùi d√πng click "X√°c Nh·∫≠n ƒê√£ Chuy·ªÉn Kho·∫£n", form submit b·∫±ng AJAX (kh√¥ng reload trang):
   - G·ª≠i d·ªØ li·ªáu ƒë·∫øn server
   - Hi·ªÉn th·ªã loading indicator
   - Ch·ªù response t·ª´ server

6. **Validate Server-Side**: Validate d·ªØ li·ªáu tr√™n server:
   - Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
   - Ki·ªÉm tra booking c√≥ t·ªìn t·∫°i kh√¥ng
   - Ki·ªÉm tra s·ªë ti·ªÅn c√≥ b·∫±ng t·ªïng ti·ªÅn booking kh√¥ng

7. **Insert V√†o Database**: Insert x√°c nh·∫≠n thanh to√°n v√†o b·∫£ng payment_confirmations:
   - booking_code, bank_name, account_number, account_name, amount
   - status = 'pending' (ch·ªù admin x√°c nh·∫≠n)
   - created_at = th·ªùi gian hi·ªán t·∫°i

8. **G·ª≠i Email**: G·ª≠i email x√°c nh·∫≠n ƒë·∫øn kh√°ch h√†ng:
   - M√£ booking
   - Th√¥ng tin chuy·ªÉn kho·∫£n
   - S·ªë ti·ªÅn
   - H∆∞·ªõng d·∫´n ti·∫øp theo

9. **Tr·∫£ V·ªÅ Response**: Tr·∫£ v·ªÅ JSON response:
   - N·∫øu th√†nh c√¥ng: `{"success": true}`
   - N·∫øu l·ªói: `{"success": false, "error": "..."}`

10. **Hi·ªÉn Th·ªã K·∫øt Qu·∫£**: D·ª±a tr√™n response:
    - N·∫øu th√†nh c√¥ng: ·∫©n form, hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
    - N·∫øu l·ªói: hi·ªÉn th·ªã th√¥ng b√°o l·ªói, cho ph√©p th·ª≠ l·∫°i

#### File: payment-vnpay.php

**M·ª•c ƒê√≠ch**: X·ª≠ l√Ω thanh to√°n VNPay

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **L·∫•y Booking ID**: L·∫•y booking_id t·ª´ POST parameter.

2. **L·∫•y Th√¥ng Tin Booking**: Query database ƒë·ªÉ l·∫•y th√¥ng tin booking.

3. **T·∫°o URL Thanh To√°n**: T·∫°o URL thanh to√°n VNPay v·ªõi c√°c tham s·ªë:
   - M√£ merchant (TMN Code)
   - S·ªë ti·ªÅn
   - M√¥ t·∫£ giao d·ªãch
   - URL callback
   - Timestamp
   - Hash (HMAC SHA512)

4. **Chuy·ªÉn H∆∞·ªõng**: Chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng ƒë·∫øn c·ªïng thanh to√°n VNPay.

5. **Ng∆∞·ªùi D√πng Thanh To√°n**: Ng∆∞·ªùi d√πng nh·∫≠p th√¥ng tin th·∫ª, x√°c th·ª±c OTP, VNPay x·ª≠ l√Ω giao d·ªãch.

6. **Callback**: VNPay g·ª≠i callback v·ªÅ h·ªá th·ªëng v·ªõi k·∫øt qu·∫£ giao d·ªãch.

#### File: payment-return.php

**M·ª•c ƒê√≠ch**: X·ª≠ l√Ω callback t·ª´ VNPay

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **Nh·∫≠n Callback**: Nh·∫≠n callback t·ª´ VNPay v·ªõi c√°c tham s·ªë:
   - M√£ giao d·ªãch VNPay
   - M√£ booking
   - S·ªë ti·ªÅn
   - K·∫øt qu·∫£ giao d·ªãch (0 = th√†nh c√¥ng, kh√°c 0 = th·∫•t b·∫°i)
   - Hash (ƒë·ªÉ x√°c th·ª±c)

2. **X√°c Th·ª±c Hash**: X√°c th·ª±c hash ƒë·ªÉ ƒë·∫£m b·∫£o callback t·ª´ VNPay:
   - T√≠nh hash t·ª´ c√°c tham s·ªë
   - So s√°nh v·ªõi hash t·ª´ callback
   - N·∫øu kh√¥ng kh·ªõp, t·ª´ ch·ªëi callback

3. **C·∫≠p Nh·∫≠t Database**: N·∫øu thanh to√°n th√†nh c√¥ng:
   - C·∫≠p nh·∫≠t payment_status = 'paid'
   - C·∫≠p nh·∫≠t booking_status = 'confirmed'
   - L∆∞u m√£ giao d·ªãch VNPay

4. **G·ª≠i Email**: G·ª≠i email x√°c nh·∫≠n cho kh√°ch h√†ng.

5. **Hi·ªÉn Th·ªã K·∫øt Qu·∫£**: Hi·ªÉn th·ªã trang k·∫øt qu·∫£ (th√†nh c√¥ng ho·∫∑c th·∫•t b·∫°i).

### 3.4.3 Ch·ª©c NƒÉng Qu·∫£n L√Ω

#### File: quan-ly-booking.php

**M·ª•c ƒê√≠ch**: Cho ph√©p admin qu·∫£n l√Ω booking

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **Ki·ªÉm Tra Quy·ªÅn**: Ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ ph·∫£i admin kh√¥ng. N·∫øu kh√¥ng, redirect ƒë·∫øn login.

2. **Hi·ªÉn Th·ªã Danh S√°ch**: Hi·ªÉn th·ªã danh s√°ch t·∫•t c·∫£ booking:
   - M√£ booking, t√™n kh√°ch h√†ng, ng√†y kh·ªüi h√†nh, s·ªë ng∆∞·ªùi, t·ªïng ti·ªÅn, tr·∫°ng th√°i booking, tr·∫°ng th√°i thanh to√°n
   - Ph√¢n trang (10 booking/trang)
   - S·∫Øp x·∫øp theo ng√†y t·∫°o (m·ªõi nh·∫•t tr∆∞·ªõc)

3. **T√¨m Ki·∫øm**: Cho ph√©p t√¨m ki·∫øm booking theo:
   - M√£ booking
   - T√™n kh√°ch h√†ng
   - Email
   - S·ªë ƒëi·ªán tho·∫°i

4. **S·∫Øp X·∫øp**: Cho ph√©p s·∫Øp x·∫øp theo:
   - Ng√†y t·∫°o (tƒÉng/gi·∫£m)
   - Ng√†y kh·ªüi h√†nh (tƒÉng/gi·∫£m)
   - T·ªïng ti·ªÅn (tƒÉng/gi·∫£m)

5. **Xem Chi Ti·∫øt**: Click v√†o booking ƒë·ªÉ xem chi ti·∫øt:
   - T·∫•t c·∫£ th√¥ng tin kh√°ch h√†ng
   - Th√¥ng tin tour
   - Y√™u c·∫ßu ƒë·∫∑c bi·ªát
   - Tr·∫°ng th√°i booking, thanh to√°n

6. **S·ª≠a Booking**: Cho ph√©p s·ª≠a booking (n·∫øu ch∆∞a thanh to√°n):
   - S·ª≠a s·ªë ng∆∞·ªùi
   - S·ª≠a ng√†y kh·ªüi h√†nh
   - S·ª≠a y√™u c·∫ßu ƒë·∫∑c bi·ªát
   - T·ª± ƒë·ªông t√≠nh l·∫°i t·ªïng ti·ªÅn

7. **X√≥a Booking**: Cho ph√©p x√≥a booking (ch·ªâ n·∫øu ch∆∞a thanh to√°n):
   - X√°c nh·∫≠n tr∆∞·ªõc khi x√≥a
   - X√≥a booking v√† c√°c x√°c nh·∫≠n thanh to√°n li√™n quan

8. **Export**: Cho ph√©p export danh s√°ch booking ra file Excel ho·∫∑c PDF.

#### File: quan-ly-thanh-toan.php

**M·ª•c ƒê√≠ch**: Cho ph√©p admin qu·∫£n l√Ω thanh to√°n

**Ch·ª©c NƒÉng Ch√≠nh**:
1. **Ki·ªÉm Tra Quy·ªÅn**: Ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ ph·∫£i admin kh√¥ng.

2. **Hi·ªÉn Th·ªã Danh S√°ch**: Hi·ªÉn th·ªã danh s√°ch t·∫•t c·∫£ thanh to√°n:
   - M√£ booking, ph∆∞∆°ng th·ª©c thanh to√°n, s·ªë ti·ªÅn, tr·∫°ng th√°i, ng√†y t·∫°o
   - Ph√¢n trang
   - S·∫Øp x·∫øp theo ng√†y t·∫°o (m·ªõi nh·∫•t tr∆∞·ªõc)

3. **T√¨m Ki·∫øm**: Cho ph√©p t√¨m ki·∫øm theo:
   - M√£ booking
   - Ph∆∞∆°ng th·ª©c thanh to√°n
   - Tr·∫°ng th√°i

4. **Xem Chi Ti·∫øt**: Click v√†o thanh to√°n ƒë·ªÉ xem chi ti·∫øt:
   - M√£ booking
   - Ph∆∞∆°ng th·ª©c thanh to√°n
   - Th√¥ng tin chuy·ªÉn kho·∫£n (ng√¢n h√†ng, s·ªë t√†i kho·∫£n, t√™n ch·ªß t√†i kho·∫£n, s·ªë ti·ªÅn)
   - Tr·∫°ng th√°i
   - Ng√†y t·∫°o

5. **X√°c Nh·∫≠n Thanh To√°n**: Cho ph√©p x√°c nh·∫≠n thanh to√°n chuy·ªÉn kho·∫£n:
   - Ki·ªÉm tra th√¥ng tin chuy·ªÉn kho·∫£n
   - X√°c nh·∫≠n ho·∫∑c t·ª´ ch·ªëi
   - G·ª≠i email cho kh√°ch h√†ng

6. **C·∫≠p Nh·∫≠t Tr·∫°ng Th√°i**: C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n:
   - T·ª´ 'pending' sang 'confirmed' ho·∫∑c 'rejected'
   - T·ª± ƒë·ªông c·∫≠p nh·∫≠t booking_status n·∫øu c·∫ßn

## 3.5 Testing

### 3.5.1 Unit Testing
- Test validate form
- Test t√≠nh gi√° ti·ªÅn
- Test t·∫°o booking code

### 3.5.2 Integration Testing
- Test flow ƒë·∫∑t tour
- Test flow thanh to√°n
- Test flow qu·∫£n l√Ω

### 3.5.3 User Acceptance Testing
- Test tr√™n c√°c tr√¨nh duy·ªát kh√°c nhau
- Test tr√™n mobile
- Test performance

## 3.6 K·∫øt Lu·∫≠n Ch∆∞∆°ng

Ch∆∞∆°ng 3 ƒë√£ tr√¨nh b√†y chi ti·∫øt v·ªÅ:
- Ph√¢n t√≠ch y√™u c·∫ßu ch·ª©c nƒÉng v√† phi ch·ª©c nƒÉng
- Thi·∫øt k·∫ø database, API, giao di·ªán
- C√†i ƒë·∫∑t m√¥i tr∆∞·ªùng
- Tri·ªÉn khai c√°c ch·ª©c nƒÉng ch√≠nh
- Testing


## 3.7 Chi Ti·∫øt Tri·ªÉn Khai T·ª´ng Ch·ª©c NƒÉng

### 3.7.1 Ch·ª©c NƒÉng ƒê·∫∑t Tour - Chi Ti·∫øt

#### B∆∞·ªõc 1: Hi·ªÉn Th·ªã Form (dat-tour.php)

**C·∫•u tr√∫c HTML:**
```html
<form id="bookingForm" method="POST" action="process-booking.php">
    <div class="form-group">
        <label>H·ªç v√† t√™n *</label>
        <input type="text" name="customer_name" required 
               placeholder="Nguy·ªÖn VƒÉn A">
    </div>
    
    <div class="form-group">
        <label>Email *</label>
        <input type="email" name="customer_email" required 
               placeholder="email@example.com">
    </div>
    
    <div class="form-group">
        <label>S·ªë ƒëi·ªán tho·∫°i *</label>
        <input type="tel" name="customer_phone" required 
               placeholder="0901234567">
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label>S·ªë ng∆∞·ªùi l·ªõn *</label>
            <input type="number" name="num_adults" required 
                   min="1" value="1">
        </div>
        
        <div class="form-group">
            <label>S·ªë tr·∫ª em</label>
            <input type="number" name="num_children" 
                   min="0" value="0">
        </div>
    </div>
    
    <div class="form-group">
        <label>Ng√†y kh·ªüi h√†nh *</label>
        <input type="date" name="departure_date" required>
    </div>
    
    <div class="form-group">
        <label>Y√™u c·∫ßu ƒë·∫∑c bi·ªát</label>
        <textarea name="special_requests" rows="3"></textarea>
    </div>
    
    <button type="submit" class="btn-submit">
        ƒê·∫∑t Tour Ngay
    </button>
</form>
```

**JavaScript Validation:**
```javascript
document.getElementById('bookingForm').addEventListener('submit', function(e) {
    const name = document.querySelector('input[name="customer_name"]').value;
    const email = document.querySelector('input[name="customer_email"]').value;
    const phone = document.querySelector('input[name="customer_phone"]').value;
    
    // Validate email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        e.preventDefault();
        alert('Email kh√¥ng h·ª£p l·ªá');
        return;
    }
    
    // Validate phone
    const phoneRegex = /^[0-9]{10}$/;
    if (!phoneRegex.test(phone)) {
        e.preventDefault();
        alert('S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10 ch·ªØ s·ªë');
        return;
    }
    
    // Validate name
    if (name.trim().length < 3) {
        e.preventDefault();
        alert('H·ªç t√™n ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±');
        return;
    }
});
```

#### B∆∞·ªõc 2: X·ª≠ L√Ω Form (process-booking.php)

**Validate Server-Side:**
```php
<?php
session_start();
require_once 'config/database.php';

if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    die('Invalid request');
}

try {
    // L·∫•y d·ªØ li·ªáu
    $customer_name = isset($_POST['customer_name']) ? trim($_POST['customer_name']) : '';
    $customer_email = isset($_POST['customer_email']) ? trim($_POST['customer_email']) : '';
    $customer_phone = isset($_POST['customer_phone']) ? trim($_POST['customer_phone']) : '';
    $num_adults = isset($_POST['num_adults']) ? (int)$_POST['num_adults'] : 1;
    $num_children = isset($_POST['num_children']) ? (int)$_POST['num_children'] : 0;
    $departure_date = isset($_POST['departure_date']) ? trim($_POST['departure_date']) : '';
    $special_requests = isset($_POST['special_requests']) ? trim($_POST['special_requests']) : '';
    
    // Validate
    if (empty($customer_name) || strlen($customer_name) < 3) {
        throw new Exception('H·ªç t√™n ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±');
    }
    
    if (!filter_var($customer_email, FILTER_VALIDATE_EMAIL)) {
        throw new Exception('Email kh√¥ng h·ª£p l·ªá');
    }
    
    if (!preg_match('/^[0-9]{10}$/', $customer_phone)) {
        throw new Exception('S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10 ch·ªØ s·ªë');
    }
    
    if ($num_adults < 1) {
        throw new Exception('Ph·∫£i c√≥ √≠t nh·∫•t 1 ng∆∞·ªùi l·ªõn');
    }
    
    if (strtotime($departure_date) < strtotime('today')) {
        throw new Exception('Ng√†y kh·ªüi h√†nh ph·∫£i >= ng√†y h√¥m nay');
    }
    
    // K·∫øt n·ªëi database
    $database = new Database();
    $db = $database->getConnection();
    
    // T·∫°o booking code
    $booking_code = 'TOUR' . date('YmdHis') . rand(100, 999);
    
    // T√≠nh gi√°
    $adult_price = 500000;
    $child_price = 300000;
    $total_price = ($num_adults * $adult_price) + ($num_children * $child_price);
    
    // Insert booking
    $query = "INSERT INTO tour_bookings 
              (booking_code, departure_date, customer_name, customer_phone, 
               customer_email, num_adults, num_children, total_price,
               booking_status, special_requests, payment_method, payment_status)
              VALUES (:booking_code, :departure_date, :customer_name, :customer_phone,
                      :customer_email, :num_adults, :num_children, :total_price,
                      :booking_status, :special_requests, :payment_method, :payment_status)";
    
    $stmt = $db->prepare($query);
    $success = $stmt->execute(array(
        ':booking_code' => $booking_code,
        ':departure_date' => $departure_date,
        ':customer_name' => $customer_name,
        ':customer_phone' => $customer_phone,
        ':customer_email' => $customer_email,
        ':num_adults' => $num_adults,
        ':num_children' => $num_children,
        ':total_price' => $total_price,
        ':booking_status' => 'pending',
        ':special_requests' => $special_requests,
        ':payment_method' => 'pending',
        ':payment_status' => 'pending'
    ));
    
    if (!$success) {
        $error = $stmt->errorInfo();
        throw new Exception('L·ªói SQL: ' . $error[2]);
    }
    
    // Chuy·ªÉn h∆∞·ªõng
    header('Location: payment-tour-method.php?booking_id=' . urlencode($booking_code));
    exit;
    
} catch (Exception $e) {
    // Hi·ªÉn th·ªã l·ªói
    ?>
    <!DOCTYPE html>
    <html>
    <head>
        <title>L·ªói</title>
        <style>
            body { font-family: Arial; padding: 50px; text-align: center; }
            .error { background: #f8d7da; padding: 20px; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="error">
            <h1>‚ùå C√≥ l·ªói x·∫£y ra</h1>
            <p><?php echo htmlspecialchars($e->getMessage()); ?></p>
            <a href="dat-tour.php">Quay L·∫°i</a>
        </div>
    </body>
    </html>
    <?php
    exit;
}
?>
```

### 3.7.2 Ch·ª©c NƒÉng Thanh To√°n - Chi Ti·∫øt

#### B∆∞·ªõc 1: Ch·ªçn Ph∆∞∆°ng Th·ª©c (payment-tour-method.php)

**Hi·ªÉn th·ªã th√¥ng tin booking:**
```php
<?php
session_start();
require_once 'config/database.php';

$booking_id = $_GET['booking_id'] ?? null;

if (!$booking_id) {
    die('Thi·∫øu th√¥ng tin booking');
}

$database = new Database();
$conn = $database->getConnection();

$query = "SELECT * FROM tour_bookings WHERE booking_code = :code OR id = :id";
$stmt = $conn->prepare($query);
$stmt->execute([':code' => $booking_id, ':id' => $booking_id]);
$booking = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$booking) {
    die('Kh√¥ng t√¨m th·∫•y booking');
}

$total_amount = $booking['total_price'];
?>
```

**HTML hi·ªÉn th·ªã:**
```html
<div class="booking-summary">
    <div class="summary-row">
        <span>M√£ Booking:</span>
        <strong><?php echo htmlspecialchars($booking['booking_code']); ?></strong>
    </div>
    <div class="summary-row">
        <span>Ng√†y Kh·ªüi H√†nh:</span>
        <strong><?php echo date('d/m/Y', strtotime($booking['departure_date'])); ?></strong>
    </div>
    <div class="summary-row">
        <span>S·ªë Ng∆∞·ªùi:</span>
        <strong><?php echo ($booking['num_adults'] + $booking['num_children']); ?> ng∆∞·ªùi</strong>
    </div>
    <div class="summary-row">
        <span>T·ªïng Ti·ªÅn:</span>
        <strong><?php echo number_format($total_amount, 0, ',', '.'); ?> VNƒê</strong>
    </div>
</div>

<form id="paymentMethodForm" method="POST" action="payment-tour-form.php">
    <input type="hidden" name="booking_id" value="<?php echo htmlspecialchars($booking['id']); ?>">
    
    <div class="payment-methods">
        <label class="payment-method-card">
            <input type="radio" name="method" value="vnpay" required>
            <div class="payment-method-icon">üí≥</div>
            <div class="payment-method-name">VNPay</div>
            <div class="payment-method-desc">Thanh to√°n qua th·∫ª ng√¢n h√†ng</div>
        </label>
        
        <label class="payment-method-card">
            <input type="radio" name="method" value="bank_transfer">
            <div class="payment-method-icon">üè¶</div>
            <div class="payment-method-name">Chuy·ªÉn Kho·∫£n</div>
            <div class="payment-method-desc">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</div>
        </label>
    </div>
    
    <button type="submit" class="btn-continue">Ti·∫øp T·ª•c</button>
</form>
```

#### B∆∞·ªõc 2: Form Thanh To√°n (payment-tour-form.php)

**HTML Form:**
```html
<form id="paymentForm">
    <div class="form-section">
        <h5>Th√¥ng Tin T√†i Kho·∫£n Chuy·ªÉn Kho·∫£n</h5>
        
        <div class="form-group">
            <label>Ch·ªçn Ng√¢n H√†ng *</label>
            <select name="bank_name" required>
                <option value="">-- Ch·ªçn ng√¢n h√†ng --</option>
                <option value="Vietcombank">Vietcombank</option>
                <option value="VietinBank">VietinBank</option>
                <option value="BIDV">BIDV</option>
                <option value="Agribank">Agribank</option>
                <option value="Techcombank">Techcombank</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>S·ªë T√†i Kho·∫£n *</label>
            <input type="text" name="account_number" 
                   placeholder="Nh·∫≠p s·ªë t√†i kho·∫£n" required>
        </div>
        
        <div class="form-group">
            <label>T√™n Ch·ªß T√†i Kho·∫£n *</label>
            <input type="text" name="account_holder" 
                   placeholder="Nh·∫≠p t√™n ch·ªß t√†i kho·∫£n" required>
        </div>
        
        <div class="form-group">
            <label>S·ªë Ti·ªÅn C·∫ßn Chuy·ªÉn *</label>
            <input type="number" name="transfer_amount" 
                   value="<?php echo $total_amount; ?>" required>
        </div>
    </div>
    
    <div class="form-section">
        <h5>Th√¥ng Tin Ng∆∞·ªùi Thanh To√°n</h5>
        
        <div class="form-group">
            <label>H·ªç T√™n *</label>
            <input type="text" name="payer_name" required>
        </div>
        
        <div class="form-group">
            <label>Email *</label>
            <input type="email" name="payer_email" required>
        </div>
        
        <div class="form-group">
            <label>S·ªë ƒêi·ªán Tho·∫°i *</label>
            <input type="tel" name="payer_phone" required>
        </div>
    </div>
    
    <button type="submit" class="btn-payment">
        X√°c Nh·∫≠n ƒê√£ Chuy·ªÉn Kho·∫£n
    </button>
</form>
```

**JavaScript AJAX:**
```javascript
document.getElementById('paymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    formData.append('ajax', '1');
    formData.append('booking_id', '<?php echo htmlspecialchars($booking['id']); ?>');
    
    const btn = this.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...';
    
    fetch('', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('formContent').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
        } else {
            alert('L·ªói: ' + data.error);
            btn.disabled = false;
            btn.innerHTML = 'X√°c Nh·∫≠n ƒê√£ Chuy·ªÉn Kho·∫£n';
        }
    })
    .catch(error => {
        alert('L·ªói k·∫øt n·ªëi');
        btn.disabled = false;
        btn.innerHTML = 'X√°c Nh·∫≠n ƒê√£ Chuy·ªÉn Kho·∫£n';
    });
});
```

**PHP X·ª≠ L√Ω AJAX:**
```php
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['ajax'])) {
    header('Content-Type: application/json');
    
    $booking_id = $_POST['booking_id'] ?? '';
    $bank_name = $_POST['bank_name'] ?? '';
    $account_number = $_POST['account_number'] ?? '';
    $account_holder = $_POST['account_holder'] ?? '';
    
    try {
        // Validate
        if (empty($bank_name) || empty($account_number) || empty($account_holder)) {
            throw new Exception('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin');
        }
        
        // L·∫•y booking
        $query = "SELECT * FROM tour_bookings WHERE id = :id";
        $stmt = $conn->prepare($query);
        $stmt->execute([':id' => $booking_id]);
        $booking = $stmt->fetch(PDO::FETCH_ASSOC);
        
        if (!$booking) {
            throw new Exception('Kh√¥ng t√¨m th·∫•y booking');
        }
        
        // Insert payment confirmation
        $insert_query = "INSERT INTO payment_confirmations 
                         (booking_code, bank_name, account_number, account_name, amount, status)
                         VALUES (:booking_code, :bank_name, :account_number, :account_holder, :amount, 'pending')";
        
        $insert_stmt = $conn->prepare($insert_query);
        $insert_stmt->execute([
            ':booking_code' => $booking['booking_code'],
            ':bank_name' => $bank_name,
            ':account_number' => $account_number,
            ':account_holder' => $account_holder,
            ':amount' => $booking['total_price']
        ]);
        
        echo json_encode(['success' => true]);
        exit;
    } catch (Exception $e) {
        echo json_encode(['success' => false, 'error' => $e->getMessage()]);
        exit;
    }
}
?>
```

## 3.8 X·ª≠ L√Ω L·ªói v√† Exception

### 3.8.1 C√°c Lo·∫°i L·ªói Ch√≠nh

| L·ªói | Nguy√™n Nh√¢n | Gi·∫£i Ph√°p |
|---|---|---|
| Validation Error | D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá | Hi·ªÉn th·ªã th√¥ng b√°o l·ªói |
| Database Error | K·∫øt n·ªëi DB th·∫•t b·∫°i | Retry ho·∫∑c hi·ªÉn th·ªã l·ªói |
| Payment Error | Thanh to√°n th·∫•t b·∫°i | Cho ph√©p th·ª≠ l·∫°i |
| Session Error | Session h·∫øt h·∫°n | Redirect ƒë·∫øn login |

### 3.8.2 Error Handling

```php
try {
    // Code ch√≠nh
    if (!$data) {
        throw new Exception('D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá');
    }
} catch (PDOException $e) {
    // Database error
    error_log('Database error: ' . $e->getMessage());
    throw new Exception('L·ªói k·∫øt n·ªëi database');
} catch (Exception $e) {
    // General error
    error_log('Error: ' . $e->getMessage());
    throw $e;
}
```

## 3.9 K·∫øt Lu·∫≠n Ch∆∞∆°ng

Ch∆∞∆°ng 3 ƒë√£ tr√¨nh b√†y chi ti·∫øt v·ªÅ:
- Ph√¢n t√≠ch y√™u c·∫ßu ch·ª©c nƒÉng v√† phi ch·ª©c nƒÉng
- Thi·∫øt k·∫ø database, API, giao di·ªán
- C√†i ƒë·∫∑t m√¥i tr∆∞·ªùng
- Tri·ªÉn khai c√°c ch·ª©c nƒÉng ch√≠nh v·ªõi code chi ti·∫øt
- X·ª≠ l√Ω l·ªói v√† exception
- Testing
